.. _config_system:

##########################
Environment Configuration
##########################

An MetaDrive instance accepts a dict as the environmental config. For example, you can build a MetaDrive instance with 200 generated maps via::

    from metadrive import MetaDriveEnv
    config = dict(
        environment_num=200,
        start_seed=0
    )
    env = MetaDriveEnv(config)


In this page, we describe the meaning of each configuration options.

MetaDriveEnv Config
###########################

We do generalization experiments under the default setting of MetaDriveEnv. To reproduce our experiment results,
no special configuration is needed.

However, MetaDrive can also support other research topics, and we will simply introduce the meaning of some configuration
options of MetaDriveEnv.

Draw Scene & Visualization
###########################

    - :code:`use_render` (bool): Pop a window on your screen or not
    - :code:`offscreen_render` (bool): When you want to access the image of camera, it should be set to True.
    - :code:`force_fps` (Union[int, None]): Decide the render fps. "None" means that no fps limitation.
    - :code:`debug` (bool): For developing use, draw the scene with bounding box

Manual Control
################

    - :code:`controller` (str): "joystick" or "keyboard". Controlling vehicle by joystick is more recommended.
    - :code:`manual_control` (bool): Controllers above are available only when this flag is True
    - :code:`use_chase_camera` (bool): A perspective like racing game. usually True, when manual control
    - :code:`camera_height` (float): Chase camera height

TrafficManager Config
#################

    - :code:`traffic_density` (float): Vehicle number per 10 meter, aiming to adjust the number of vehicle on road
    - :code:`traffic_mode`: Trigger mode (Triger) / reborn mode (Reborn). In Reborn mode vehicles will enter the map again after arriving its destination.
    - :code:`random_traffic` (bool): the traffic generation will not be controlled by current map seed. If set to *False*, each map will have same traffic flow.

Map Config
#############
    -   :code:`map` (int or string): You can set a *string* or *int* as the key to generate map in an easy way. An *int=N* means generating a map containing N blocks,
        and the block type is randomly selected. Since in MetaDrive each block has a unique ID in *char* type, *string* can determine the block type sequence.
        For example, "SCrRX" means the first block is Straight, and the next blocks are Circular, InRamp, OutRamp and Intersection.
        We provide the following block types:

            +---------------+-----------+
            | Block Type    |    ID     |
            +===============+===========+
            | Straight      |     S     |
            +---------------+-----------+
            | Circular      |     C     |
            +---------------+-----------+
            | InRamp        |     r     |
            +---------------+-----------+
            | OutRamp       |     R     |
            +---------------+-----------+
            | Roundabout    |     O     |
            +---------------+-----------+
            | Intersection  |     X     |
            +---------------+-----------+
            | TIntersection |     T     |
            +---------------+-----------+
            | Fork          |   (WIP)   |
            +---------------+-----------+


    - :code:`map_config` (dict): The original map config. Find more information in Map source code, or find usage in our test scripts.

        - :code:`type` (str): The map can be generated by BIG according to BLOCK_NUM, BLOCK_SEQUENCE, or MAP_FILE
        - :code:`config` (srt): A int telling BIG the total block number under BLOCK_NUM mode, or a str describing BLOCK_SEQUENCE
          (each block has a unique character severing as its ID, so combining them to get a map, the parameters of these block
          is sampled by BIG), and under MAP_FILE mode the config should be a dict describing the whole map.
        - :code:`lane_width` (float): Width of lanes.
        - :code:`lane_num` (int): Number of lanes in each road.

Generalization Environment Config
##################################

    - :code:`start_seed` (int): Random seed of first map.
    - :code:`environment_num` (int): Number of environments. BIG generates map by a random generator initialized by a specific seed.
      Therefore, "environment_num" maps are generated by seeds \[seed for seed in range(start_seed,
      start_seed+environment_num)\]

Observation Config
######################

    - :code:`offscreen_render` (bool): If you want to use camera data, please set this to True.
    - :code:`rgb_clip` (bool): Squeeze the value between \[0, 255\] to \[0.0, 1.0\]
    - :code:`vehicle_config` (dict): Sensor parameters for vehicle
    - :code:`image_source` (str): decided which camera image to use (mini_map or front camera). Now we only support capture one image as a part of
      observation.

Action Config
#######################

    - :code:`decision_repeat` (int): The minimal step size of the world is 2e-2 second, and thus for agent the world will step
      decision_repeat * 2e-2 second after applying one action or step.


Reward Scheme
####################
Coefficient of different kinds of reward to describe the driving goal
Find more information by accessing our source code in MetaDriveEnv
You can adjust our primitive reward function or design your own reward function

Misc.
##########

    - :code:`use_increment_steering` (bool): Keyboard control use discretized action such as -1, 0, +1. You can set this value to True to make the keyboard strokes serve as increments to existing action.
    - :code:`action_check` (bool): Check whether the value of action is between \[0.0, 1.0\] or not.
    - :code:`engine_config` (dict): Some basic settings for low-level physics world. More information can be found in source code.

PGWorld Config
################
    This is the core of MetaDrive, including physics engine, task manager and so on.
     - :code:`window_size` (tuple): Width, height of rendering window.
     - :code:`debug` (bool): The debug value in MetaDriveEnv will be passed to PGWorld.
     - :code:`physics_world_step_size` (float): The minimum step size of bullet physics engine.
     - :code:`show_fps` (bool): Turn on/ turn off the frame rater.
     - :code:`force_fps` (None or float): *None* means no render fps limit, while *float* indicates the maximum render FPS.
     - :code:`decision_repeat` (int): This will be written by MetaDriveEnv to do ForceFPS.
     - :code:`debug_physics_world` (bool): Only render physics world without model, a special debug option.
     - :code:`headless_machine_render` (bool): Set this to true only when training on headless machine and use rgb image!!!!!!
     - :code:`use_render` (bool): The value is same as *use_render* in MetaDriveEnv
     - :code:`offscreen_render` (bool): The value is same as *offscreen_render* in MetaDriveEnv.




Vehicle Config
################

We list the vehicle config here. Observation Space will be adjusted by these config automatically.
Find more information and in our source code and test scripts!

- :code:`lidar` (tuple): (laser num, distance, other vehicle info num)
- :code:`rgb_camera` (tuple): (camera resolution width(int), camera resolution height(int), we use (84, 84) as the default value like what Nature DQN did in Atari.
- :code:`mini_map` (tuple): (camera resolution width(int), camera resolution height(int), camera height). The bird-view image can be captured by this camera.
- :code:`show_navi_mark` (bool): A spinning navigation mark will be shown in the scene
- :code:`increment_steering` (bool): For keyboard control using. When set to True, the steering angle is determined by the key pressing time.
- :code:`wheel_friction` (float): Friction coefficient
